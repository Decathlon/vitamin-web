<div class="block">
  <div
    class="vtmn-progressbar_container vtmn-progressbar_variant--circular vtmn-progressbar_size--small"
    role="progressbar"
    aria-labelledby="progress-bar-circular-1"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-valuenow="50"
  >
    <span id="progress-bar-circular-1" class="vtmn-sr-only">Loading</span>
    <span class="vtmn-progressbar_label">50%</span>
    <svg>
      <circle
        class="vtmn-progressbar_indicator"
        stroke-dashoffset="calc(200px - (200px * 50) / 100)"
        cx="50%"
        cy="50%"
        r="32"
      />
    </svg>
  </div>
</div>

<div class="block">
  <div
    class="vtmn-progressbar_container vtmn-progressbar_variant--circular"
    role="progressbar"
    aria-labelledby="progress-bar-circular-2"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-valuenow="60"
  >
    <span id="progress-bar-circular-2" class="vtmn-sr-only">Loading</span>
    <span class="vtmn-progressbar_label">60%</span>
    <svg>
      <circle class="vtmn-progressbar_track" cx="50%" cy="50%" r="64" />
      <circle
        class="vtmn-progressbar_indicator"
        stroke-dashoffset="calc(400px - (400px * 60) / 100)"
        cx="50%"
        cy="50%"
        r="64"
      />
    </svg>
  </div>
</div>

<div class="block">
  <div
    class="vtmn-progressbar_container vtmn-progressbar_variant--circular vtmn-progressbar--indeterminate vtmn-progressbar_size--small"
    role="progressbar"
    aria-labelledby="progress-bar-circular-3"
  >
    <span id="progress-bar-circular-3" class="vtmn-sr-only">Loading</span>
    <svg>
      <circle class="vtmn-progressbar_track" cx="50%" cy="50%" r="32" />
      <circle class="vtmn-progressbar_indicator" cx="50%" cy="50%" r="32" />
    </svg>
  </div>
</div>

<div class="block">
  <div
    class="vtmn-progressbar_container vtmn-progressbar_variant--circular vtmn-progressbar--indeterminate"
    role="progressbar"
    aria-labelledby="progress-bar-circular-4"
  >
    <span id="progress-bar-circular-4" class="vtmn-sr-only">Loading</span>
    <svg>
      <circle class="vtmn-progressbar_track" cx="50%" cy="50%" r="64" />
      <circle class="vtmn-progressbar_indicator" cx="50%" cy="50%" r="64" />
    </svg>
  </div>
</div>

<div class="block">
  <div
    id="vtmn-progressbar-container-demo-1"
    class="vtmn-progressbar_container vtmn-progressbar_variant--circular"
    role="progressbar"
    aria-labelledby="progress-bar-demo-1"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-valuenow="0"
  >
    <span id="progress-bar-demo-1" class="vtmn-sr-only">Loading</span>
    <span
      id="vtmn-progressbar-label-demo-1"
      class="vtmn-progressbar_label"
      aria-live="assertive"
      >0%</span
    >
    <svg>
      <circle class="vtmn-progressbar_track" cx="50%" cy="50%" r="64" />
      <circle
        id="vtmn-progressbar-demo-1"
        class="vtmn-progressbar_indicator"
        stroke-dashoffset="calc(400 - (400 * 0) / 100)"
        cx="50%"
        cy="50%"
        r="64"
      />
    </svg>
  </div>
</div>

<div class="block">
  <div
    id="vtmn-progressbar-container-demo-2"
    class="vtmn-progressbar_container vtmn-progressbar_variant--circular vtmn-progressbar_size--small"
    role="progressbar"
    aria-labelledby="progress-bar-circular-demo-2"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-valuenow="50"
  >
    <span id="progress-bar-circular-demo-2" class="vtmn-sr-only">Loading</span>
    <span
      id="vtmn-progressbar-label-demo-2"
      class="vtmn-progressbar_label"
      aria-live="assertive"
      >0%</span
    >
    <svg>
      <circle
        id="vtmn-progressbar-demo-2"
        class="vtmn-progressbar_indicator"
        stroke-dashoffset="calc(200 - (200 * 0) / 100)"
        cx="50%"
        cy="50%"
        r="32"
      />
    </svg>
  </div>
</div>

<div class="block">
  <button id="btn-launch-demo" class="vtmn-btn vtmn-btn_variant--primary">
    Launch demo
  </button>
</div>

<div class="accessibility-highlight">
  <div
    class="vtmn-divider vtmn-divider_orientation--horizontal vtmn-divider_text-position--start"
    role="separator"
    aria-labelledby="title-header-4"
  >
    <span id="title-header-4">Accessibility highlight</span>
  </div>

  <div class="accessibility-highlight_container">
    <div class="accessibility-highlight_container_component">
      <div
        class="vtmn-progressbar_container vtmn-progressbar_variant--circular vtmn-progressbar_size--small"
        role="progressbar"
        aria-labelledby="progress-bar-circular-5"
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow="70"
      >
        <span id="progress-bar-circular-5" class="vtmn-sr-only">Loading</span>
        <img
          class="vtmn-progressbar_image"
          src="https://storage.googleapis.com/dkt-design-cdn/images/landscape-placeholder.jpg"
          alt="Black and white grid"
        />
        <svg>
          <circle
            class="vtmn-progressbar_indicator"
            stroke-dashoffset="calc(200px - (200px * 70) / 100)"
            cx="50%"
            cy="50%"
            r="32"
          />
        </svg>
      </div>

      <div
        class="vtmn-progressbar_container vtmn-progressbar_variant--circular"
        role="progressbar"
        aria-labelledby="progress-bar-circular-6"
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow="80"
      >
        <span id="progress-bar-circular-6" class="vtmn-sr-only">Loading</span>
        <img
          class="vtmn-progressbar_image"
          src="https://storage.googleapis.com/dkt-design-cdn/images/landscape-placeholder.jpg"
          alt="Black and white grid"
        />
        <svg>
          <circle class="vtmn-progressbar_track" cx="50%" cy="50%" r="64" />
          <circle
            class="vtmn-progressbar_indicator"
            stroke-dashoffset="calc(400px - (400px * 80) / 100)"
            cx="50%"
            cy="50%"
            r="64"
          />
        </svg>
      </div>
    </div>

    <div class="accessibility-highlight_container_alert">
      <p>
        In order to deliver an accessible component, you must be aware that the
        pourcentage of the progression must be displayed and visible.
        <br />This example doesn't embed the pourcentage to let you display it
        how you want (according to the Design System guildelines).
      </p>
    </div>
  </div>
</div>

<script>
  document
    .getElementById('btn-launch-demo')
    .addEventListener('click', initCircularProgressbarShowcase, { once: true });

  function initCircularProgressbarShowcase() {
    for (let i = 1; i <= 2; i++) {
      let container = document.getElementById(
        `vtmn-progressbar-container-demo-${i}`,
      );
      let label = document.getElementById(`vtmn-progressbar-label-demo-${i}`);
      let progress = document.getElementById(`vtmn-progressbar-demo-${i}`);

      resetProgress(container, progress, label);
      launchProgress(container, progress, label);
    }

    function launchProgress(container, progress, label) {
      setInterval(() => {
        let random = getRandom(1, 15);
        let textLabel = label.textContent;
        let currentLabelValue = Number(
          textLabel.substring(0, textLabel.length - 1),
        );
        let newValue = Number(currentLabelValue + random);
        if (newValue >= 100) {
          newValue = 100;
          addProgress(container, progress, label, newValue);
          setTimeout(() => {
            resetProgress(container, progress, label);
          }, 2000);
        } else {
          addProgress(container, progress, label, newValue);
        }
      }, 1000);
    }

    function getRandom(min, max) {
      return Math.ceil(Math.random() * (max - min) + min);
    }

    function addProgress(container, progress, label, value) {
      label.textContent = `${value}%`;
      container.setAttribute('aria-valuenow', `${value}`);
      setCircularProgress(container, progress, value);
    }

    function setCircularProgress(container, progress, value) {
      if (container.classList.contains('vtmn-progressbar_size--small')) {
        progress.setAttribute(
          'stroke-dashoffset',
          `calc(200px - (200px * ${value}) / 100)`,
        );
      } else {
        progress.setAttribute(
          'stroke-dashoffset',
          `calc(400px - (400px * ${value}) / 100)`,
        );
      }
    }

    function resetProgress(container, progress, label) {
      label.textContent = '0%';
      container.setAttribute('aria-valuenow', '0');
      setCircularProgress(container, progress, 0);
    }
  }
</script>
